<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Egan - Admin V10</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #0a1628 0%, #1a2f4a 50%, #0a1628 100%); 
            color: #fff; 
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        header { 
            text-align: center; 
            padding: 30px 0; 
            border-bottom: 3px solid rgba(0,150,255,0.6); 
            margin-bottom: 30px;
            background: rgba(26,47,74,0.4);
            border-radius: 15px;
        }
        h1 { 
            font-size: 42px; 
            color: #00d4ff; 
            text-shadow: 0 0 30px rgba(0,200,255,0.9); 
            margin-bottom: 10px;
        }
        .subtitle { 
            color: rgba(255,255,255,0.8); 
            font-size: 18px; 
            font-weight: bold;
        }
        
        .tabs { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 30px; 
            justify-content: center; 
            flex-wrap: wrap; 
        }
        .tab { 
            background: rgba(26,47,74,0.5); 
            padding: 15px 30px; 
            border: 2px solid rgba(0,150,255,0.3); 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            color: rgba(255,255,255,0.7); 
            transition: all 0.3s;
        }
        .tab:hover, .tab.active { 
            background: rgba(0,150,255,0.3); 
            color: #00d4ff; 
            border-color: #00d4ff; 
            transform: translateY(-3px);
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .section { 
            background: rgba(26,47,74,0.4); 
            border: 2px solid rgba(0,150,255,0.3); 
            border-radius: 15px; 
            padding: 30px; 
            margin-bottom: 25px;
        }
        .section h2 { color: #00d4ff; font-size: 24px; margin-bottom: 20px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { 
            display: block; 
            color: #00d4ff; 
            margin-bottom: 8px; 
            font-weight: bold; 
            font-size: 15px;
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            background: rgba(10,22,40,0.8); 
            color: #fff; 
            border: 2px solid rgba(0,150,255,0.4); 
            padding: 12px; 
            border-radius: 8px; 
            font-size: 15px;
            font-family: inherit;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
            outline: none; 
            border-color: #00d4ff; 
            box-shadow: 0 0 15px rgba(0,200,255,0.4);
        }
        
        .btn { 
            background: linear-gradient(135deg, #00d4ff, #0088cc); 
            color: #fff; 
            padding: 15px 35px; 
            border: none; 
            border-radius: 10px; 
            font-size: 17px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        .btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0,200,255,0.6);
        }
        .btn-success { background: linear-gradient(135deg, #00ff88, #00cc66); }
        .btn-danger { background: linear-gradient(135deg, #ff4444, #cc0000); }
        .btn-small { padding: 8px 15px; font-size: 14px; }
        .btn-add { background: linear-gradient(135deg, #00ff88, #00cc66); }
        
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); 
            gap: 25px;
        }
        .product-card { 
            background: rgba(10,22,40,0.7); 
            border: 2px solid rgba(0,150,255,0.4); 
            border-radius: 15px; 
            padding: 25px;
        }
        .product-preview { 
            width: 100%; 
            height: 250px; 
            object-fit: contain; 
            background: rgba(0,0,0,0.5); 
            border-radius: 10px; 
            margin-bottom: 20px;
            border: 2px solid rgba(0,150,255,0.3);
        }
        
        .categories-list { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            margin-top: 20px;
        }
        .category-tag { 
            background: rgba(0,150,255,0.2); 
            color: #00d4ff; 
            padding: 12px 20px; 
            border-radius: 10px; 
            border: 2px solid rgba(0,150,255,0.4); 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-weight: bold;
        }
        
        .varieties-list, .prices-list { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            margin-top: 10px;
        }
        .variety-item, .price-item { 
            display: flex; 
            gap: 10px; 
            align-items: center;
        }
        .variety-item input, .price-item input { width: auto; flex: 1; }
        
        .save-section { 
            position: sticky; 
            bottom: 20px; 
            background: rgba(10,22,40,0.95); 
            backdrop-filter: blur(10px); 
            padding: 25px; 
            border-radius: 15px; 
            border: 3px solid #00d4ff; 
            text-align: center; 
            box-shadow: 0 -5px 30px rgba(0,200,255,0.4);
            margin-top: 40px;
        }
        
        .notification { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, #00d4ff, #0088cc); 
            color: #fff; 
            padding: 20px 30px; 
            border-radius: 12px; 
            box-shadow: 0 5px 25px rgba(0,200,255,0.6); 
            font-weight: bold; 
            font-size: 16px; 
            opacity: 0; 
            transition: opacity 0.3s; 
            z-index: 10000;
            max-width: 400px;
        }
        .notification.show { opacity: 1; }
        
        .help-text { 
            color: rgba(255,255,255,0.5); 
            font-size: 13px; 
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .products-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öôÔ∏è Coffee Egan - Admin V10</h1>
            <p class="subtitle">G√®re facilement ton shop - Modifications en temps r√©el</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('general')">üè† G√©n√©ral</button>
            <button class="tab" onclick="showTab('categories')">üìÇ Cat√©gories</button>
            <button class="tab" onclick="showTab('products')">üì¶ Produits</button>
            <button class="tab" onclick="showTab('info')">‚ÑπÔ∏è Infos</button>
        </div>
        
        <!-- G√âN√âRAL -->
        <div id="tab-general" class="tab-content active">
            <div class="section">
                <h2>üè† Param√®tres G√©n√©raux</h2>
                <div class="form-group">
                    <label>Nom du site</label>
                    <input type="text" id="siteName" placeholder="Coffee Egan">
                </div>
                <div class="form-group">
                    <label>Logo URL</label>
                    <input type="text" id="logoUrl" placeholder="logo.png">
                    <p class="help-text">Change l'URL pour voir le logo se mettre √† jour</p>
                    <img id="logoPreview" src="" style="width:100px;height:100px;object-fit:contain;margin-top:10px;border:2px solid rgba(0,150,255,0.3);border-radius:10px;">
                </div>
                <div class="form-group">
                    <label>Username Telegram (sans @)</label>
                    <input type="text" id="telegramUsername" placeholder="werebeu92">
                </div>
                <div class="form-group">
                    <label>Instagram URL</label>
                    <input type="text" id="instagramUrl" placeholder="https://instagram.com/...">
                </div>
                <div class="form-group">
                    <label>Canal Telegram URL</label>
                    <input type="text" id="canalUrl" placeholder="https://t.me/...">
                </div>
            </div>
        </div>
        
        <!-- CAT√âGORIES -->
        <div id="tab-categories" class="tab-content">
            <div class="section">
                <h2>üìÇ Gestion des Cat√©gories</h2>
                <p style="color:rgba(255,255,255,0.7);margin-bottom:20px;">Ajoute/supprime des cat√©gories. Elles apparaissent automatiquement dans les produits !</p>
                <div class="form-group">
                    <label>Ajouter une cat√©gorie</label>
                    <div style="display:flex;gap:10px;">
                        <input type="text" id="newCategory" placeholder="Ex: resine, pre-rolls..." style="flex:1;">
                        <button class="btn" onclick="addCategory()">‚ûï Ajouter</button>
                    </div>
                </div>
                <div class="categories-list" id="categoriesList"></div>
            </div>
        </div>
        
        <!-- PRODUITS -->
        <div id="tab-products" class="tab-content">
            <div class="section">
                <h2>üì¶ Gestion des Produits</h2>
                <button class="btn btn-add" onclick="addNewProduct()">‚ûï Ajouter un nouveau produit</button>
                <div class="products-grid" id="productsGrid" style="margin-top:25px;"></div>
            </div>
        </div>
        
        <!-- INFOS -->
        <div id="tab-info" class="tab-content">
            <div class="section">
                <h2>‚ÑπÔ∏è Page √Ä propos</h2>
                <div class="form-group">
                    <label>Titre</label>
                    <input type="text" id="infoTitle" placeholder="√Ä propos">
                </div>
                <div class="form-group">
                    <label>Texte principal</label>
                    <textarea id="infoMainText" placeholder="Description..."></textarea>
                </div>
            </div>
            <div class="section">
                <h2>üì¶ Livraison</h2>
                <div class="form-group">
                    <label>Titre</label>
                    <input type="text" id="infoDeliveryTitle" placeholder="Livraison">
                </div>
                <div class="form-group">
                    <label>Texte</label>
                    <textarea id="infoDeliveryText" placeholder="Infos livraison..."></textarea>
                </div>
            </div>
            <div class="section">
                <h2>üí≥ Paiement</h2>
                <div class="form-group">
                    <label>Titre</label>
                    <input type="text" id="infoPaymentTitle" placeholder="Paiement">
                </div>
                <div class="form-group">
                    <label>Texte</label>
                    <textarea id="infoPaymentText" placeholder="Modes de paiement..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- SAVE SECTION -->
        <div class="save-section">
            <p style="color:rgba(255,255,255,0.8);margin-bottom:15px;">Clique pour t√©l√©charger les fichiers mis √† jour</p>
            <button class="btn btn-success" onclick="saveAll()">üíæ SAUVEGARDER (T√©l√©charger fichiers)</button>
            <button class="btn btn-danger" onclick="resetAll()">üîÑ RESET</button>
            <p style="color:#00d4ff;margin-top:15px;font-size:14px;">Remplace products.js et config.js, puis recharge index.html avec CTRL+F5</p>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script src="config.js"></script>
    <script src="products.js"></script>
    <script>
let categories = (siteConfig && siteConfig.categories) ? [...siteConfig.categories] : ['fleurs', 'concentres', 'edibles'];
let nextId = Math.max(...products.map(p => p.id)) + 1;

window.onload = () => {
    loadUI();
    notify('üî• Admin V10 charg√© ! Tes ' + products.length + ' produits sont pr√™ts !');
};

function loadUI() {
    document.getElementById('siteName').value = siteConfig.siteName || 'Coffee Egan';
    document.getElementById('logoUrl').value = siteConfig.logoUrl || 'logo.png';
    document.getElementById('telegramUsername').value = siteConfig.telegramUsername || 'werebeu92';
    document.getElementById('instagramUrl').value = siteConfig.instagramUrl || '';
    document.getElementById('canalUrl').value = siteConfig.canalUrl || '';
    document.getElementById('infoTitle').value = siteConfig.infoTitle || '√Ä propos';
    document.getElementById('infoMainText').value = siteConfig.infoMainText || 'Bienvenue !';
    document.getElementById('infoDeliveryTitle').value = siteConfig.infoDeliveryTitle || 'Livraison';
    document.getElementById('infoDeliveryText').value = siteConfig.infoDeliveryText || 'Livraison rapide.';
    document.getElementById('infoPaymentTitle').value = siteConfig.infoPaymentTitle || 'Paiement';
    document.getElementById('infoPaymentText').value = siteConfig.infoPaymentText || 'Paiements s√©curis√©s.';
    
    document.getElementById('logoPreview').src = siteConfig.logoUrl || 'logo.png';
    document.getElementById('logoUrl').oninput = function() {
        document.getElementById('logoPreview').src = this.value;
    };
    
    loadCategories();
    renderProducts();
}

function showTab(name) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
    document.getElementById('tab-' + name).classList.add('active');
    event.target.classList.add('active');
}

// CAT√âGORIES
function loadCategories() {
    const list = document.getElementById('categoriesList');
    list.innerHTML = categories.map(c => `
        <div class="category-tag">
            <span>${c.toUpperCase()}</span>
            <button class="btn btn-small btn-danger" onclick="removeCategory('${c}')">‚úï</button>
        </div>
    `).join('');
}

function addCategory() {
    const input = document.getElementById('newCategory');
    const val = input.value.trim().toLowerCase();
    if (!val) { notify('‚ö†Ô∏è Entre un nom de cat√©gorie'); return; }
    if (categories.includes(val)) { notify('‚ö†Ô∏è Cette cat√©gorie existe d√©j√†'); return; }
    categories.push(val);
    input.value = '';
    loadCategories();
    renderProducts();
    notify(`‚úÖ Cat√©gorie "${val}" ajout√©e !`);
}

function removeCategory(cat) {
    if (!confirm(`Supprimer "${cat}" ?`)) return;
    categories = categories.filter(c => c !== cat);
    loadCategories();
    renderProducts();
    notify(`‚úÖ Cat√©gorie "${cat}" supprim√©e`);
}

// PRODUITS
function renderProducts() {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = products.map((p, i) => `
        <div class="product-card">
            <img src="${p.image}" class="product-preview" id="preview-${i}" onerror="this.src='https://via.placeholder.com/400x400/0080ff/fff?text=${p.name}'">
            <div class="form-group">
                <label>üè∑Ô∏è Nom</label>
                <input value="${p.name}" onchange="updateProduct(${i}, 'name', this.value)">
            </div>
            <div class="form-group">
                <label>üìÇ Cat√©gorie</label>
                <select onchange="updateProduct(${i}, 'category', this.value)">
                    ${categories.map(c => `<option value="${c}" ${p.category===c?'selected':''}>${c.toUpperCase()}</option>`).join('')}
                </select>
            </div>
            <div class="form-group">
                <label>üñºÔ∏è Image URL</label>
                <input value="${p.image}" onchange="updateProductImage(${i}, this.value)">
                <p class="help-text">L'image se met √† jour direct</p>
            </div>
            <div class="form-group">
                <label>üé• Vid√©o URL (optionnel)</label>
                <input value="${p.video||''}" onchange="updateProduct(${i}, 'video', this.value)">
            </div>
            <div class="form-group">
                <label>üìù Description</label>
                <textarea onchange="updateProduct(${i}, 'description', this.value)">${p.description}</textarea>
            </div>
            <div class="form-group">
                <label>üåø Vari√©t√©s</label>
                <div class="varieties-list">
                    ${p.varieties.map((v,vi) => `
                        <div class="variety-item">
                            <input value="${v}" onchange="updateVariety(${i}, ${vi}, this.value)">
                            <button class="btn btn-small btn-danger" onclick="removeVariety(${i},${vi})">‚úï</button>
                        </div>
                    `).join('')}
                </div>
                <button class="btn btn-small btn-add" onclick="addVariety(${i})">+ Ajouter</button>
            </div>
            <div class="form-group">
                <label>üí∞ Prix & Quantit√©s</label>
                <div class="prices-list">
                    ${p.prices.map((pr,pi) => `
                        <div class="price-item">
                            <input value="${pr.amount}" onchange="updatePrice(${i}, ${pi}, 'amount', this.value)" style="flex:0 0 90px" placeholder="Prix">
                            <input value="${pr.quantity}" onchange="updatePrice(${i}, ${pi}, 'quantity', this.value)" placeholder="Quantit√©">
                            <button class="btn btn-small btn-danger" onclick="removePrice(${i},${pi})">‚úï</button>
                        </div>
                    `).join('')}
                </div>
                <button class="btn btn-small btn-add" onclick="addPrice(${i})">+ Ajouter</button>
            </div>
            <button class="btn btn-danger" style="width:100%;margin-top:15px;" onclick="removeProduct(${i})">üóëÔ∏è Supprimer</button>
        </div>
    `).join('');
}

function updateProduct(i, field, value) {
    products[i][field] = value;
    notify(`‚úÖ ${field} mis √† jour`);
}

function updateProductImage(i, url) {
    products[i].image = url;
    document.getElementById(`preview-${i}`).src = url;
    notify(`‚úÖ Image mise √† jour`);
}

function updateVariety(i, vi, value) {
    products[i].varieties[vi] = value;
    notify(`‚úÖ Vari√©t√© mise √† jour`);
}

function updatePrice(i, pi, field, value) {
    products[i].prices[pi][field] = value;
    notify(`‚úÖ Prix mis √† jour`);
}

function addVariety(i) {
    products[i].varieties.push('Nouvelle vari√©t√©');
    renderProducts();
    notify('‚úÖ Vari√©t√© ajout√©e');
}

function removeVariety(i, vi) {
    products[i].varieties.splice(vi, 1);
    renderProducts();
    notify('‚úÖ Vari√©t√© supprim√©e');
}

function addPrice(i) {
    products[i].prices.push({ amount: '10‚Ç¨', quantity: '1g' });
    renderProducts();
    notify('‚úÖ Prix ajout√©');
}

function removePrice(i, pi) {
    products[i].prices.splice(pi, 1);
    renderProducts();
    notify('‚úÖ Prix supprim√©');
}

function addNewProduct() {
    products.push({
        id: nextId++,
        name: 'Nouveau Produit',
        category: categories[0],
        image: 'https://via.placeholder.com/400x400/0080ff/fff?text=Nouveau+Produit',
        video: '',
        description: 'Description du produit',
        varieties: ['Vari√©t√© 1', 'Vari√©t√© 2'],
        prices: [{ amount: '10‚Ç¨', quantity: '1g' }]
    });
    renderProducts();
    notify('‚úÖ Nouveau produit ajout√© !');
}

function removeProduct(i) {
    if (!confirm(`Supprimer "${products[i].name}" ?`)) return;
    products.splice(i, 1);
    renderProducts();
    notify('‚úÖ Produit supprim√©');
}

function saveAll() {
    const config = {
        siteName: document.getElementById('siteName').value,
        logoUrl: document.getElementById('logoUrl').value,
        telegramUsername: document.getElementById('telegramUsername').value,
        miniAppUrl: '',
        instagramUrl: document.getElementById('instagramUrl').value,
        canalUrl: document.getElementById('canalUrl').value,
        contactUsername: document.getElementById('telegramUsername').value,
        infoTitle: document.getElementById('infoTitle').value,
        infoMainText: document.getElementById('infoMainText').value,
        infoDeliveryTitle: document.getElementById('infoDeliveryTitle').value,
        infoDeliveryText: document.getElementById('infoDeliveryText').value,
        infoPaymentTitle: document.getElementById('infoPaymentTitle').value,
        infoPaymentText: document.getElementById('infoPaymentText').value,
        categories: categories
    };
    
    const productsCode = `const TELEGRAM_USERNAME="${config.telegramUsername}";\n\nconst products = ${JSON.stringify(products, null, 2)};`;
    const configCode = `const siteConfig = ${JSON.stringify(config, null, 2)};`;
    
    downloadFile(productsCode, 'products.js');
    setTimeout(() => downloadFile(configCode, 'config.js'), 600);
    
    notify('üíæ SAUVEGARD√â ! Remplace products.js et config.js, puis CTRL+F5 sur index.html');
}

function downloadFile(content, filename) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([content], {type: 'text/javascript'}));
    a.download = filename;
    a.click();
}

function resetAll() {
    if (confirm('‚ö†Ô∏è RESET COMPLET ? Tout sera perdu !')) {
        location.reload();
    }
}

function notify(message) {
    const notif = document.getElementById('notification');
    notif.textContent = message;
    notif.classList.add('show');
    setTimeout(() => notif.classList.remove('show'), 4000);
}
    </script>
</body>
</html>
